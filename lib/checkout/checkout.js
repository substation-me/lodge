"use strict";(function(){var a=window.lodge;a.braintree={eventAttached:!1,generateToken:function generateToken(b){a.embedded||a.getTemplate({templateName:"checkout",loadCSS:!1,successCallback:function(c){var d=document.createElement("div");d.innerHTML=c,d.className="ccform-wrapper",a.overlay.reveal({innerContent:d});for(var e=document.querySelector("#braintree-token-form"),f=document.querySelector("#button-pay"),g=document.querySelectorAll("#braintree-token-form input"),h=g.length,j=0;j<h;j++)g[j].addEventListener("focus",function(b){a.styles.addClass({el:b.target.parentNode,className:"braintree-hosted-fields-focused"})}),g[j].addEventListener("blur",function(b){a.styles.removeClass({el:b.target.parentNode,className:"braintree-hosted-fields-focused"})});f.disabled=!0,braintree.client.create({authorization:b.braintree},function(c,g){if(c)return void console.error(c);var h=new Date;braintree.hostedFields.create({client:g,styles:{input:{color:"#282c37","font-size":"16px",transition:"color 0.1s","line-height":"3"},"input.invalid":{color:"#E53A40"},"::-webkit-input-placeholder":{color:"rgba(0,0,0,0.4)"},":-moz-placeholder":{color:"rgba(0,0,0,0.4)"},"::-moz-placeholder":{color:"rgba(0,0,0,0.4)"},":-ms-input-placeholder":{color:"rgba(0,0,0,0.4)"}},fields:{number:{selector:"#card-number",placeholder:"0000 0000 0000 0000"},cvv:{selector:"#cvv",placeholder:"123"},expirationDate:{selector:"#expiration-date",placeholder:"".concat(h.getMonth()," / ").concat(h.getFullYear()+1)}}},function(c,d){return c?void console.error(c):void(d.on("validityChange",function(b){var c=Object.keys(b.fields).every(function(a){return b.fields[a].isValid});c?(a.styles.addClass({el:f,className:"show-button"}),f.disabled=!1):(a.styles.removeClass({el:f,className:"show-button"}),f.disabled=!0)}),d.on("empty",function(){document.querySelector("#card-image").className="",e.className=""}),d.on("cardTypeChange",function(b){1===b.cards.length?(e.className="",a.styles.addClass({el:e,className:b.cards[0].type}),document.querySelector("#card-image").className="",a.styles.addClass({el:document.querySelector("#card-image"),className:b.cards[0].type}),4===b.cards[0].code.size&&d.setAttribute({field:"cvv",attribute:"placeholder",value:"1234"})):d.setAttribute({field:"cvv",attribute:"placeholder",value:"123"})}),f.addEventListener("click",function(c){c.preventDefault(),d.tokenize(function(c,d){if(c)a.debug.out(c);else{var e="email=".concat(document.querySelector("#email").value,"&firstName=").concat(document.querySelector("#first-name").value,"&lastName=").concat(document.querySelector("#last-name").value,"&amount=").concat(b.amount,"&nonce=").concat(d.nonce);a.overlay.showLoading(),a.ajax.send({url:b.endpoint,postString:e,successCallback:function(c){"OK"===c?a.overlay.reveal({innerContent:"<h2 class=\"vv-checkout-success\">".concat(b.successMsg,"</h2>")}):a.overlay.reveal({innerContent:"<h2 class=\"vv-checkout-error\">".concat(b.errorMsg,"</h2>")})}})}})},!1))})})}})}},a.checkout={prepped:!1,prep:function prep(){a.checkout.prepped||a.getScript({url:"https://js.braintreegateway.com/web/3.46.0/js/client.min.js",callback:function(){a.getScript({url:"https://js.braintreegateway.com/web/3.46.0/js/hosted-fields.min.js",callback:function(){a.styles.injectCSS({css:"".concat(a.path,"/templates/checkout.css"),top:!0}),a.checkout.prepped=!0}})}})},begin:function begin(b,c){if(a.embedded)a.events.fire({obj:a,type:"begincheckout",data:b});else{a.checkout.prep();var d=Object.assign({braintree:!1,paypal:!1,currency:!1,firstName:!1,lastName:!1,email:!1,recurring:!1,amount:!1,endpoint:"",successMsg:"Success.",errorMsg:"There was a problem."},b);a.checkout.initiatepayment(d,c)}},initiatepayment:function initiatepayment(b,c){if(b.braintree&&!b.paypal)a.braintree.generateToken(b,c);else if(!b.braintree&&b.paypal)a.events.fire({obj:a,type:"checkoutdata",data:b,target:c}),a.overlay.reveal({innerContent:"<div class=\"vv-loading\"></div>"});else if(b.braintree&&b.paypal){var f=document.createElement("div");f.className="vv-checkout-choose";var d=document.createElement("span"),e=document.createElement("span");d.innerHTML="Pay with PayPal",d.className="pay-pp",e.innerHTML="Pay with a credit card",e.className="pay-cc",d.addEventListener("click",function(d){d.preventDefault(),d.stopPropagation(),a.events.fire({obj:a,type:"checkoutdata",data:b,target:c}),a.overlay.showLoading()}),e.addEventListener("click",function(d){d.preventDefault(),d.stopPropagation(),a.braintree.generateToken(b.braintree,c)}),f.appendChild(d),f.appendChild(e),a.overlay.reveal({innerContent:f})}else a.checkout.showerror()},showerror:function showerror(){a.overlay.reveal({innerContent:"<div class=\"vv-checkout-error\">There are no valid payment types. Please add a payment connection. Check to make sure your site supports SSL (https) if you are using Braintree.</div>"})}}})();