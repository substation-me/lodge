window.lodge||(window.lodge=function e(){const e={embedded:!1,eventlist:{},get:{},lightbox:!1,loaded:!1,id:"",options:"",parent:"",path:"",scripts:[],storage:{},templates:{},_constructor(){const a=window.lodge,t=document.querySelector("script[src$=\"lodge.js\"]");if(t){a.path=t.src.substr(0,t.src.length-9);try{e.options=JSON.parse(`{"${t.getAttribute("data-options").replace(/&/g,"\",\"").replace(/=/g,"\":\"")}"}`)}catch(t){e.options="error"}}if(a._findEmbeds(),a.get.qs=window.location.search.substring(1),a.get.params=!1,a.get.qs){a.get.params={};let e;const t=a.get.qs.split("&");for(let l=0;l<t.length;l++)e=t[l].split("="),a.get.params[e[0]]=decodeURIComponent(e[1])}if(a.get.params.debug&&(a.debug.show=!0),self!==top){if(a.options.noembed)return!1;a.styles.addClass({el:document.documentElement,className:"lodge__embed"}),a._initEmbed()}else a.id="lodge main";a.get.params.overlay&&a.styles.addClass({el:document.documentElement,className:"lodge__embed--overlay"});const l=document.querySelectorAll("a.lodge.gallery,div.lodge.gallery");(a.options.lightboxvideo||0<l.length)&&a.getScript({url:`${a.path}/modules/lightbox.js`}),window.addEventListener("message",function(t){-1!==a.embeds.allowed.indexOf(t.origin)&&a._handleMessage(t)}),a.embeds.allowed+=window.location.href.split("/").slice(0,3).join("/"),a.get.params.location&&(a.embeds.allowed+=a.get.params.location.split("/").slice(0,3).join("/")),a.embedded||a.overlay.create(),a.loaded=Date.now(),a._drawQueuedEmbeds(),a.debug.out({message:"finished initializing",obj:a}),a.events.fire({obj:a,type:"ready",data:a.loaded})},_findEmbeds(){const a=document.querySelectorAll("embed.lodge");if("object"==typeof a){const l=Array.prototype.slice.call(a);l.forEach(function(t){t.style.height="1px",t.style.visibility="hidden";const a=t.getAttribute("src"),l=t.getAttribute("title"),s=t.getAttribute("data-css"),n=t.getAttribute("id"),d=e.styles.hasClass({el:t,className:"overlay"}),o=e.styles.hasClass({el:t,className:"forwardquery"});a&&e.embeds.create({src:a,alt:l,target:t,css:s,id:n,overlay:d,forwardquery:o})})}},_drawQueuedEmbeds(){const e=window.lodge;"object"==typeof e.storage.elementQueue&&e.storage.elementQueue.forEach(function(t){e.embeds.create(t)})},_initEmbed(){const e=window.lodge;e.embedded=!0,e.get.params.lodgelocation&&(e.parent=e.get.params.lodgelocation,e.embeds.allowed=`${e.embeds.allowed},${e.parent}`),e.id=e.get.params.id?e.get.params.id:window.location.href,e.get.params.cssoverride&&e.styles.injectCSS({css:e.get.params.cssoverride,important:!0}),e.get.params.fixedsize||(e.storage.embedheight=e.measure.scrollheight(),e.events.fire({obj:e,type:"resize",data:{height:e.storage.embedheight}}),window.setInterval(function(){const t=e.measure.scrollheight();t!==e.storage.embedheight&&(e.storage.embedheight=t,e.events.fire({obj:e,type:"resize",data:{height:t}}))},125))},_handleMessage(e){const t=window.lodge,a=t.utility.parseJSON(e.data),l={addclass:{handler:"styles.addClass"},begincheckout:{handler:"checkout.begin",require:"checkout"},injectcss:{handler:"styles.injectCSS"},overlayhide:{handler:"overlay.hide"},overlayreveal:{handler:"overlay.reveal"},overlaysetloading:{handler:"overlay.setLoading"},removeclass:{handler:"styles.removeClass"},resize:{handler:"embeds.resize"},swapclasses:{handler:"styles.swapClasses"}};let s=!1;if(a&&a.lodge)if(t.embedded&&window.parent===e.source)s=!0;else for(let l=0;l<t.embeds.all.length;l++)if(t.embeds.all[l].el.contentWindow===e.source){s=!0,t.embeds.all[l].el.source||(t.embeds.all[l].source=e.source),a.data._source=t.embeds.all[l];break}if(s)if(l[a.type]){const e=l[a.type].handler.split("."),s=e.pop();let n=t;e.length&&!l[a.type].require&&(n=t[e[0]]),l[a.type].require?t.getScript({url:`${t.path}/modules/${l[a.type].require}.js`,callback:function(){n=t[e[0]],n[s](a.data)}}):n[s](a.data)}else"ready"!==a.type&&t.events.fire({obj:t,type:a.type,data:a.data,target:!1,localonly:!0})},getTemplate({templateName:e,successCallback:t,loadCSS:a=!0}){const l=window.lodge,{templates:s}=l;if(void 0!==s[e])t(s[e]);else if(this.ajax.jsonp({url:`${l.path}/templates/${e}.js`,callback:function(a){s[e]=a.template,t(a.template)},remoteCallback:`_${e}Callback`}),a){const t=document.querySelectorAll(`link[href="${l.path}/templates/${e}.css"]`);t.length||l.styles.injectCSS({css:`${l.path}/templates/${e}.css`})}},getScript({url:e,callback:t}){const a=window.lodge;if(-1<a.scripts.indexOf(e))"function"==typeof t&&t();else{a.scripts.push(e);const l=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.src=e;let n=!1;s.onload=s.onreadystatechange=function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,"function"==typeof t&&t(),s.onload=s.onreadystatechange=null,l&&s.parentNode&&l.removeChild(s))},l.insertBefore(s,l.firstChild)}a.debug.out({message:`loaded script: ${e}`})},embeds:{allowed:"",all:[],create({src:e,alt:s="open",target:t,css:a,id:l,overlay:n=!1,forwardquery:d=!1}){const o=window.lodge;let r;if(!o.loaded)"object"!=typeof o.storage.elementQueue&&(o.storage.elementQueue=[]),o.storage.elementQueue.push({src:e,alt:s,target:t,css:a,id:l,overlay:n,forwardquery:d});else if(r="string"==typeof targetNode?document.querySelector(t):t,r){const t={src:e,css:a,overlay:n,id:l,forwardquery:d};if(n){const e=document.createElement("span");e.className="lodge__overlay-open",o.overlay.create(function(){const l=document.createElement("a");l.href="",l.target="_blank",l.innerHTML=s,e.appendChild(l),r.parentNode.insertBefore(e,r),function(){l.addEventListener("click",function(a){o.overlay.reveal({innerContent:t,embedRequest:!0}),a.preventDefault()})}()})}else{const e=o.embeds.buildIframe(t);r.parentNode.insertBefore(e,r)}"EMBED"===r.tagName&&r.parentNode.removeChild(r)}},buildIframe({src:e,css:t,overlay:a,id:l,forwardquery:s=!1}){const n=window.lodge,d=document.createElement("iframe");let o=e;const r=encodeURIComponent(`${location.protocol}//${location.hostname}${location.port?`:${location.port}`:""}`);l||(l=`lodge__${new Date().getTime()}`),o+=`?lodgelocation=${r}&id=${l}`,t&&(o+=`&cssoverride=${encodeURIComponent(t)}`),s&&(o+=`&${n.get.qs}`),a&&(o+="&overlay=1"),n.debug.show&&(o+=`&debug=true`),d.src=o,d.id=l,d.className="lodge__embed",d.style.width="100%",d.style.height="0",d.style.border="0",d.style.overflow="hidden",d.style.display="block",d.scrolling="no";let i=window.location;return o.includes("://")&&(i=o.split("/").slice(0,3).join("/"),-1===n.embeds.allowed.indexOf(i)&&(n.embeds.allowed+=`,${i}`)),n.embeds.all.push({id:l,el:d,src:e,source:null,origin:i}),n.debug.out({message:`building iframe for ${l}`}),d},resize({_source:e,height:t}){const a=e.el;a.height=t,a.style.height=`${t}px`},getById(e){const t=window.lodge;let a=!1;for(let l=0;l<t.embeds.all.length;l++)if(t.embeds.all[l].id===e){a=t.embeds.all[l];break}return a}},debug:{show:!1,store({message:e,obj:t}){const a=window.lodge;a.storage.debug||(a.storage.debug=[]),a.storage.debug.push({message:e,obj:t})},out({message:e,obj:t}){const a=window.lodge;if(a.debug.show){if(!a.loaded)return void a.debug.store({message:e,obj:t});const l={main:{logo:"color:#093;font-weight:bold;",name:"color:#093;font-weight:bold;",message:"font-weight:normal;"},embed:{logo:"color:#69f;font-weight:bold;",name:"color:#69f;font-weight:bold;",message:"font-weight:normal;"}};let s="main",n="\u25B3\u25B3";a.embedded&&(s="embed",n="\u25BD\u25BD"),a.storage.debug?(console.groupCollapsed(`%c${n}%c ${a.id}:%c\n   ${e}`,l[s].logo,l[s].name,l[s].message),t&&console.log("   attachment: %O",t),a.storage.debug.forEach(function(e){e.o?console.log(`   ${e.message} %O`,e.obj):console.log(`   ${e.message}`)}),console.groupEnd(),delete a.storage.debug):t?console.log(`%c${n}%c ${a.id}:%c\n   ${e} %O`,l[s].logo,l[s].name,l[s].message,t):console.log(`%c${n}%c ${a.id}:%c\n   ${e}`,l[s].logo,l[s].name,l[s].message)}}},ajax:{send({url:e,postString:a=null,callback:t}){let l="POST";a||(l="GET");const s=new XMLHttpRequest;s&&(s.open(l,e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===l&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"function"==typeof t&&(s.onreadystatechange=function(){4===s.readyState&&(200<=s.status&&299>=s.status?t(null,s.responseText):t({error:s.responseText},null))}),s.send(a))},jsonp({url:e,callback:t,remoteCallback:a="callback"}){window[a]=function(e){t(e),delete window[a]};const l=document.createElement("script");l.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(l)},encodeForm(e){if("object"!=typeof e)return!1;let t="";e=e.elements||e;for(let a=0;a<e.length;a++){if("checkbox"===e[a].type||"radio"===e[a].type){e[a].checked&&(t+=`${(t.length?"&":"")+e[a].name}=${e[a].value}`);continue}t+=`${(t.length?"&":"")+e[a].name}=${e[a].value}`}return encodeURI(t)}},addEventListener(e,t){const a=window.lodge;a.events.addListener(e,t)},removeEventListener(e,t){const a=window.lodge;a.events.removeListener(e,t)},dispatchEvent(t){const e=window.lodge;e.events.dispatch(t)},events:{fire({obj:t,type:a,data:s="",target:l,echoTarget:n=!1,localonly:d=!1}){const o=window.lodge;let r=!0;if(l&&("string"==typeof l?l=o.embeds.getById(l):(!l.source||!l.origin)&&(l=!1),l&&l.source.postMessage(JSON.stringify({lodge:!0,type:a,data:s}),l.origin),o.debug.out({message:`targeted ${l.id} with ${a} event.`,obj:s}),r=!1),!l||l&&n){let l=null;l=document.createEvent("CustomEvent"),l.initCustomEvent(a,!1,!1,s),o.embedded&&!d&&(l.relay=r,l.source=window,l.origin=window.location.origin),t.dispatchEvent(l),l.relay&&o.events.relay({type:a,data:s});let e="firing ";l.relay&&(e="relaying "),o.debug.out({message:`${e+a} event.`,obj:s})}},relay({type:e,data:t}){const a=window.lodge;let l="*";a.parent&&(l=a.parent),window.parent.postMessage(JSON.stringify({lodge:!0,relay:!0,type:e,data:t}),l)},addListener(e,t){const a=window.lodge;a.eventlist.hasOwnProperty(e)||(a.eventlist[e]=[]),a.eventlist[e].push(t)},removeListener(e,t){const a=window.lodge;if(a.eventlist.hasOwnProperty(e)){const l=a.eventlist[e].indexOf(t);-1!==l&&a.eventlist[e].splice(l,1)}},dispatch(t){const e=window.lodge;if(e.eventlist.hasOwnProperty(t.type)){let a;for(a=0;a<e.eventlist[t.type].length;a++)e.eventlist[t.type][a]&&e.eventlist[t.type][a](t)}}},measure:{viewport(){return{x:window.innerWidth||document.body.offsetWidth||0,y:window.innerHeight||document.body.offsetHeight||0}},scrollheight(){var e=Math.max;const t=document.body,a=document.documentElement;return e(t.scrollHeight,t.offsetHeight,a.offsetHeight,t.clientHeight)}},utility:{validateEmail(e){return /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test((e+"").toLowerCase())},parseJSON(e){try{return JSON.parse(e)}catch(e){return null}}},overlay:{content:!1,close:!1,loadingContent:!1,callbacks:[],setLoading({loadString:e}){const t=window.lodge;t.overlay.loadingContent=e.toString(),t.embedded&&t.events.fire({obj:t,type:"overlaysetloading",data:{loadString:t.overlay.loadingContent}})},showLoading(){const e=window.lodge;e.overlay.loadingContent&&e.overlay.reveal({innerContent:e.overlay.loadingContent})},create(e){const t=window.lodge,a=t.overlay;t.styles.injectCSS({css:`${t.path}/templates/overlay.css`}),a.content=document.createElement("div"),a.content.className="lodge__overlay",document.addEventListener("keyup",function(t){"Escape"===t.key&&a.content.parentNode===document.body&&a.hide()}),a.close=document.createElement("div"),a.close.className="lodge__close",a.close.addEventListener("click",function(){a.content.parentNode===document.body&&a.hide()}),a.buttons=document.createElement("div"),a.buttons.className="lodge__buttons",a.buttonTrue=document.createElement("button"),a.buttonTrue.style.display="none",a.buttonFalse=document.createElement("button"),a.buttonFalse.style.display="none",a.buttons.dataset.queryName="",a.buttons.dataset.srcEmbed="",a.buttonTrue.addEventListener("click",function(l){l.preventDefault(),t.events.fire({obj:t,type:"modalchoice",data:{modal:1,queryName:a.buttons.dataset.queryName,buttonText:a.buttonTrue.textContent},target:a.buttons.dataset.srcEmbed,echoTarget:!0}),window.lodge.overlay.hide()}),a.buttonFalse.addEventListener("click",function(l){l.preventDefault(),t.events.fire({obj:t,type:"modalchoice",data:{modal:0,queryName:a.buttons.dataset.queryName,buttonText:a.buttonFalse.textContent},target:a.buttons.dataset.srcEmbed,echoTarget:!0}),window.lodge.overlay.hide()}),a.buttons.appendChild(a.buttonTrue),a.buttons.appendChild(a.buttonFalse),"function"==typeof e&&e()},hide(){const e=window.lodge,a=e.overlay,l=document.body;if(e.embedded)e.events.fire({obj:e,type:"overlayhide"});else{for(e.events.fire({obj:e,type:"overlayhidden"});a.content.firstChild;)a.content.removeChild(a.content.firstChild);a.close.parentNode===l&&l.removeChild(a.close),l.removeChild(a.content);const s=document.querySelectorAll(".lodge__overlaytrigger");if(0<s.length)for(let e=0,t=s.length;e<t;e++)s[e].style.visibility="visible";a.buttonTrue.style.display="none",a.buttonFalse.style.display="none",a.buttons.dataset.queryName="",a.buttons.dataset.srcEmbed="",e.styles.removeClass({el:document.documentElement,className:"lodge__noscroll"})}},reveal({innerContent:e,wrapClass:t="lodge__component",modal:a=!1,buttons:l=!1,embedRequest:s=!1}){const n=window.lodge,d=n.overlay,o=document.body,r=document.createElement("div"),i=document.createElement("div");if(n.embedded)n.events.fire({obj:n,type:"overlayreveal",data:{innerContent:e,wrapClass:t,modal:a,buttons:l,embedRequest:s}});else{for(;d.content.firstChild;)d.content.removeChild(d.content.firstChild);if(r.className="lodge__position",i.className=t,s){const t=e;e=n.embeds.buildIframe(t)}"string"==typeof e?i.innerHTML=e:i.appendChild(e),r.appendChild(i),d.content.appendChild(r),n.styles.hasClass({el:document.documentElement,className:"lodge__noscroll"})||n.styles.addClass({el:document.documentElement,className:"lodge__noscroll"}),a||o.appendChild(d.close),l&&(l.modal0&&(d.buttonFalse.textContent=l.modal0,d.buttonFalse.style.display="inline-block"),l.modal1&&(d.buttonTrue.textContent=l.modal1,d.buttonTrue.style.display="inline-block"),l.queryName&&(d.buttons.dataset.queryName=l.queryName),l.srcEmbed&&(d.buttons.dataset.srcEmbed=l.srcEmbed),i.appendChild(d.buttons)),d.content.parentNode!==o&&(d.content.style.opacity=0,o.appendChild(d.content),window.getComputedStyle(d.content).opacity),d.content.style.opacity=1,n.events.fire({obj:n,type:"overlayrevealed"})}}},styles:{resolveElement(e){return"string"==typeof e?"storage:"===e.substr(0,8)?window.lodge.storage[e.substr(8)]:document.querySelector(e):e},addClass({el:e,className:t,top:a=!1}){const l=window.lodge;a&&l.embedded?l.events.fire({obj:l,type:"addclass",data:{el:e,className:t}}):(e=l.styles.resolveElement(e),e&&!l.styles.hasClass({el:e,className:t})&&(e.className=`${e.className} ${t}`))},hasClass({el:e,className:t}){const a=window.lodge;return e=a.styles.resolveElement(e),-1<` ${e.className} `.indexOf(` ${t} `)},injectCSS({css:e,important:t=!1,top:a=!1}){const l=window.lodge;let s;if(a&&l.embedded)l.events.fire({obj:l,type:"injectcss",data:{css:e,important:t}});else{const a=document.getElementsByTagName("head")[0]||document.documentElement;"http"===e.substr(0,4)?(s=document.createElement("link"),s.rel="stylesheet",s.href=e):(s=document.createElement("style"),s.innerHTML=e),s.type="text/css",t?a.appendChild(s):a.insertBefore(s,a.firstChild)}},removeClass({el:e,className:t,top:a=!1}){const l=window.lodge;a&&l.embedded?l.events.fire({obj:l,type:"removeclass",data:{el:e,className:t}}):(e=l.styles.resolveElement(e),e&&(e.className=` ${e.className} `.replace(` ${t} `," ").replace(/^\s+/,"").replace(/\s+$/,"")))},swapClasses({el:e,oldClass:t,newClass:a,top:l=!1}){const s=window.lodge;l&&s.embedded?s.events.fire({obj:s,type:"swapclasses",data:{el:e,oldClass:t,newClass:a}}):(e=s.styles.resolveElement(e),e&&(e.className=` ${e.className} `.replace(` ${t} `,` ${a} `).replace(/^\s+/,"").replace(/\s+$/,"")))}},prompt:{message({message:e,context:t=!1,button:a="Close"}){const l=window.lodge;let s=`<h2>${e}</h2>`,n=!1;t&&(s+=`<p>${t}</p>`),a&&(n={modal0:a,modal1:!1}),l.overlay.reveal({innerContent:s,buttons:n})},modal({message:e,context:t,buttons:a={modal0:"Cancel",modal1:"OK"},queryName:l=""}){const s=window.lodge;a.queryName=l,a.srcEmbed=s.id;let n=`<h2>${e}</h2>`;t&&(n+=`<p>${t}</p>`),s.overlay.reveal({innerContent:n,modal:!0,buttons:a})}}};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e._constructor):e._constructor(),e}());
//# sourceMappingURL=lodge.js.map