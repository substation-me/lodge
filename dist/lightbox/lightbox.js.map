{"version":3,"sources":["../../source/lightbox/lightbox.js"],"names":["vv","window","lodge","lightbox","injectIframe","url","self","parsedUrl","parseVideoURL","overlay","reveal","innerContent","wrapClass","parsed","toLowerCase","indexOf","replace","substr","showGallery","img","caption","gallery","markup","prev","document","createElement","className","next","addEventListener","objLoop","newimg","i","newcap","c","g","querySelector","appendChild","obj","key","w","keys","Object","length","r","m","as","querySelectorAll","create","e","preventDefault","currentTarget","href","ags","tagName","hasAttribute","title","imgs","getElementsByTagName","src","alt","n"],"mappings":"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","sourcesContent":["/**\n * Handle images/videos/embeds in the primary lodge.js overlay\n *\n * @author Jesse von Doom\n * @link http://lodge.glitch.me/\n *\n * Copyright (c) 2019, Jesse von Doom\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *\n * Redistributions of source code must retain the above copyright notice, this list\n * of conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice, this\n * list of conditions and the following disclaimer in the documentation and/or other\n * materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n * IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\n * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n * OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * */\n\n(function lightbox() {\n  const vv = window.lodge;\n  vv.lightbox = {\n    injectIframe(url) {\n      const self = vv.lightbox;\n      const parsedUrl = self.parseVideoURL(url);\n      vv.overlay.reveal({\n        innerContent: `<iframe src=\"${parsedUrl}\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>`,\n        wrapClass: \"lodge__media\",\n      });\n    },\n\n    parseVideoURL(url) {\n      /*\n\t\t\tFunction parseVideoURL(string url)\n\t\t\tAccepts a URL, checks for validity youtube/vimeo, and returns a direct URL for\n\t\t\tthe embeddable URL. Returns false if no known format is found.\n\t\t\t*/\n      let parsed = false;\n      if (url.toLowerCase().indexOf(\"youtube.com/watch?v=\") !== -1) {\n        parsed = url.replace(\"watch?v=\", \"embed/\");\n        parsed = parsed.replace(\"http:\", \"https:\");\n        if (parsed.indexOf(\"&\") > -1) {\n          parsed = parsed.substr(0, parsed.indexOf(\"&\"));\n        }\n        parsed += \"?autoplay=1&autohide=1&rel=0\";\n      } else if (url.toLowerCase().indexOf(\"vimeo.com/\") !== -1) {\n        parsed = url.replace(\"www.\", \"\");\n        parsed = parsed.replace(\"vimeo.com/\", \"player.vimeo.com/video/\");\n        parsed += \"?title=1&byline=1&portrait=1&autoplay=1\";\n      }\n      return parsed;\n    },\n\n    showGallery(img, caption, gallery) {\n      let markup = `<div class=\"lodge__gallery-img\" style=\"background-image:url(${img});\"></div>`;\n      if (caption) {\n        markup += `<div class=\"lodge__gallery-caption\">${caption}</div>`;\n      }\n      vv.overlay.reveal({ innerContent: markup, wrapClass: \"lodge__gallery\" });\n      if (gallery) {\n        const prev = document.createElement(\"div\");\n        prev.className = \"lodge__gallery-prev\";\n        const next = document.createElement(\"div\");\n        next.className = \"lodge__gallery-next\";\n\n        prev.addEventListener(\"click\", function (e) {\n          const prev = vv.lightbox.objLoop(gallery, img, \"prev\");\n          const newimg = prev.i;\n          const newcap = prev.c;\n          vv.lightbox.showGallery(newimg, newcap, gallery);\n        });\n        next.addEventListener(\"click\", function (e) {\n          const next = vv.lightbox.objLoop(gallery, img, \"next\");\n          const newimg = next.i;\n          const newcap = next.c;\n          vv.lightbox.showGallery(newimg, newcap, gallery);\n        });\n\n        const g = document.querySelector(\".lodge__gallery\");\n        g.appendChild(prev);\n        g.appendChild(next);\n      }\n    },\n\n    objLoop(obj, key, w) {\n      const keys = Object.keys(obj);\n      let g = keys[keys.length - 1];\n      let r = obj[keys[0]];\n      let m = 1;\n      if (w === \"prev\") {\n        g = keys[0];\n        r = obj[keys[keys.length - 1]];\n        m = -1;\n      }\n      if (g === key) {\n        return r;\n      }\n      for (let i = 0; i < keys.length; i++) {\n        if (keys[i] === key) {\n          return obj[keys[i + m]];\n        }\n      }\n    },\n  };\n\n  // look for links to video sites\n  const as = document.querySelectorAll(\n    'a[href*=\"youtube.com/watch?v=\"],a[href*=\"vimeo.com\"]'\n  );\n  if (as.length > 0) {\n    vv.overlay.create(function () {\n      for (let i = 0; i < as.length; ++i) {\n        as[i].addEventListener(\"click\", function (e) {\n          e.preventDefault();\n          // do the overlay thing\n          const url = e.currentTarget.href;\n          vv.lightbox.injectIframe(url);\n        });\n      }\n    });\n  }\n\n  // look for gallery links\n  const ags = document.querySelectorAll(\"a.lodge.gallery,div.lodge.gallery\");\n  if (ags.length > 0) {\n    vv.overlay.create(function () {\n      for (var i = 0; i < ags.length; ++i) {\n        if (ags[i].tagName.toLowerCase() == \"a\") {\n          ags[i].addEventListener(\"click\", function (e) {\n            e.preventDefault();\n            let caption = false;\n            const img = this.href;\n            if (this.hasAttribute(\"title\")) {\n              caption = this.title;\n            }\n            vv.lightbox.showGallery(img, caption);\n          });\n        } else {\n          const imgs = ags[i].getElementsByTagName(\"img\");\n          var gallery = {};\n          for (var i = 0; i < imgs.length; i++) {\n            const img = imgs[i].src;\n            let caption = false;\n            if (imgs[i].hasAttribute(\"title\")) {\n              caption = imgs[i].title;\n            }\n            if (!caption && imgs[i].hasAttribute(\"alt\")) {\n              caption = imgs[i].alt;\n            }\n            gallery[imgs[i].src] = { i: img, c: caption };\n          }\n          for (let n = 0; n < imgs.length; n++) {\n            imgs[n].addEventListener(\"click\", function (e) {\n              e.preventDefault();\n              vv.lightbox.showGallery(\n                gallery[this.src].i,\n                gallery[this.src].c,\n                gallery\n              );\n            });\n          }\n        }\n      }\n    });\n  }\n})();"],"file":"lightbox.js"}